# 08-布局网格（Layout Grid）

> 定义网格系统、间距规则和响应式断点

---

## 网格系统

### 主内容区宽度

**桌面端**：
```css
--sheldWidth: 50vw;  /* 默认50%视口宽度，可配置 */
max-width: 1200px;   /* 最大宽度限制 */
```

**移动端**：
```css
width: 100vw;
width: 100dvw;  /* 动态视口单位，适配虚拟键盘 */
```

---

## 间距系统

### 基础间距单位

基于 `--mainFontSize` (15px) 的倍数：

| Token | 计算值 | 近似值 | 用途 |
|-------|--------|--------|------|
| `spacing-xs` | `mainFontSize * 0.25` | ~4px | 最小间距 |
| `spacing-sm` | `mainFontSize * 0.5` | ~8px | 小间距 |
| `spacing-md` | `mainFontSize * 1` | ~15px | 标准间距 |
| `spacing-lg` | `mainFontSize * 1.5` | ~23px | 大间距 |
| `spacing-xl` | `mainFontSize * 2` | ~30px | 超大间距 |
| `spacing-2xl` | `mainFontSize * 3` | ~45px | 章节间距 |

### 间距应用规则

**组件内边距**：
- 卡片内边距: `spacing-md` (15px)
- 按钮内边距: `spacing-sm` 到 `spacing-md`
- 输入框内边距: `spacing-sm`

**组件外边距**：
- 组件间距: `spacing-md` (15px)
- 章节间距: `spacing-xl` (30px)
- 页面边距: `spacing-lg` (23px)

---

## 响应式断点

### 断点定义

| 断点名 | 最小宽度 | 用途 |
|--------|----------|------|
| Mobile | 0px | 移动设备（默认） |
| Tablet | 769px | 平板设备 |
| Desktop | 1001px | 桌面设备 |
| Large Desktop | 1441px | 大屏设备 |

### 主要断点

**移动端/桌面端分界**：
```css
@media screen and (max-width: 1000px) {
  /* 移动端样式 */
}
```

**小屏移动端**：
```css
@media screen and (max-width: 768px) {
  /* 部分组件的额外移动优化 */
}
```

---

## 容器尺寸

### 固定容器

**顶部导航栏**：
```css
height: var(--topBarBlockSize);
/* 计算值: iconSize + padding = ~30px + ~5px = ~35px */
```

**底部输入表单**：
```css
min-height: var(--bottomFormBlockSize);
/* 计算值: iconSize + padding = ~28.5px + ~6px = ~34.5px */
/* 动态高度，根据输入内容自动调整 */
```

### 弹性容器

**聊天区域**：
```css
height: calc(100vh - var(--topBarBlockSize) - var(--bottomFormBlockSize));
height: calc(100dvh - var(--topBarBlockSize) - var(--bottomFormBlockSize));
```

---

## 网格布局

### 角色网格

**桌面端**：
```css
display: grid;
grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
gap: var(--spacing-md);
```

**移动端**：
```css
@media (max-width: 1000px) {
  grid-template-columns: repeat(3, 1fr);
}

@media (max-width: 768px) {
  grid-template-columns: repeat(2, 1fr);
}

@media (max-width: 480px) {
  grid-template-columns: 1fr;
}
```

### 背景网格

```css
#bg_menu_content,
#bg_custom_content {
  display: grid;
  grid-template-columns: repeat(var(--bg-thumb-columns, 4), 1fr);
  gap: 10px;
}

@media (max-width: 1000px) {
  grid-template-columns: repeat(var(--bg-thumb-columns, 3), 1fr);
}
```

---

## Flexbox 布局

### 主轴布局

**导航栏**：
```css
display: flex;
flex-direction: row;
justify-content: space-between;
align-items: center;
gap: var(--spacing-sm);
```

**抽屉内容**：
```css
display: flex;
flex-direction: column;
gap: var(--spacing-md);
```

### 常用 Flex 类

```css
.flex-container {
  display: flex;
}

.flex-1 {
  flex: 1;
}

.flex-row {
  flex-direction: row;
}

.flex-column {
  flex-direction: column;
}

.justify-center {
  justify-content: center;
}

.justify-between {
  justify-content: space-between;
}

.align-center {
  align-items: center;
}

.gap-sm {
  gap: var(--spacing-sm);
}

.gap-md {
  gap: var(--spacing-md);
}
```

---

## Z-Index 层级

### 层级系统

| 层级 | Z-Index | 用途 |
|------|---------|------|
| 背景 | 0 | 背景图像 |
| 内容 | 1 | 主要内容 |
| 固定UI | 10 | 顶栏、底栏 |
| 抽屉 | 20 | 侧边抽屉 |
| 弹窗遮罩 | 30 | 模态弹窗遮罩层 |
| 弹窗内容 | 31 | 模态弹窗主体 |
| Toast | 40 | 提示消息 |
| 上下文菜单 | 50 | 右键菜单 |

---

## 滚动容器

### 主聊天区

```css
#chat {
  overflow-y: auto;
  overflow-x: hidden;
  height: 100%;
  scroll-behavior: smooth;
}
```

### 抽屉内容区

```css
.drawer-content {
  overflow-y: auto;
  max-height: calc(100vh - 45px);
  max-height: calc(100dvh - 45px);
}
```

### 自定义滚动条

```css
::-webkit-scrollbar {
  width: 0.7rem;
}

::-webkit-scrollbar-thumb {
  background-color: var(--grey7070a);
  box-shadow: inset 0 0 0 1px var(--black50a);
  border-radius: 10px;
  background-clip: content-box;
  border: 2px solid transparent;
  min-height: 40px;
}

::-webkit-scrollbar-track:hover {
  background-color: rgba(126, 126, 126, 0.2);
}
```

---

## 移动端布局调整

### 全屏容器

```css
@media (max-width: 1000px) {
  #sheld,
  #character_popup,
  .drawer-content {
    width: 100dvw !important;
    max-width: 100dvw;
    left: 0 !important;
    top: var(--topBarBlockSize);
  }
}
```

### 视口单位

**桌面端**：
- 使用 `vh` / `vw`

**移动端**：
- 优先使用 `dvh` / `dvw` (动态视口单位)
- 后备使用 `vh` / `vw`

```css
height: 100vh;   /* 后备 */
height: 100dvh;  /* 动态视口 */
```

---

## Figma Auto Layout 设置

### 导航栏
```
Direction: Horizontal
Padding: 5px
Gap: 8px
Alignment: Space Between
```

### 卡片网格
```
Direction: Horizontal Wrap
Padding: 15px
Gap: 15px
Min Width: 200px
```

### 抽屉内容
```
Direction: Vertical
Padding: 20px
Gap: 15px
Alignment: Top
```

---

## 导出 JSON

```json
{
  "spacing": {
    "xs": "4px",
    "sm": "8px",
    "md": "15px",
    "lg": "23px",
    "xl": "30px",
    "2xl": "45px"
  },
  "breakpoints": {
    "mobile": "0px",
    "tablet": "769px",
    "desktop": "1001px",
    "largeDesktop": "1441px"
  },
  "container": {
    "maxWidth": "1200px",
    "desktopWidth": "50vw"
  },
  "zIndex": {
    "background": 0,
    "content": 1,
    "fixedUI": 10,
    "drawer": 20,
    "modalOverlay": 30,
    "modalContent": 31,
    "toast": 40,
    "contextMenu": 50
  }
}
```
