# 11-响应式设计规范

## 文档信息
- **版本**: 1.0.0
- **最后更新**: 2025-12-21
- **依赖**: [01-设计令牌](./01-设计令牌.md), [08-布局网格](./08-布局网格.md)

---

## 概述

本文档定义SillyTavern响应式设计的完整规范，包括断点系统、流式布局、组件适配、移动端优化等，确保应用在各种设备和屏幕尺寸上都能提供最佳体验。

---

## 1. 断点系统

### 1.1 断点定义

**CSS定义**:
```css
/* 断点令牌 */
:root {
  --breakpoint-mobile: 768px;     /* 移动设备 */
  --breakpoint-tablet: 1000px;    /* 平板设备 */
  --breakpoint-desktop: 1280px;   /* 桌面设备 */
  --breakpoint-wide: 1920px;      /* 宽屏设备 */
}
```

### 1.2 媒体查询

**CSS定义**:
```css
/* 移动端优先 */
/* 默认样式针对移动端 */
.container {
  padding: var(--spacing-sm);
}

/* 平板及以上 */
@media screen and (min-width: 768px) {
  .container {
    padding: var(--spacing-md);
  }
}

/* 桌面及以上 */
@media screen and (min-width: 1000px) {
  .container {
    padding: var(--spacing-lg);
  }
}

/* 宽屏 */
@media screen and (min-width: 1920px) {
  .container {
    padding: var(--spacing-xl);
  }
}
```

### 1.3 断点范围

| 断点名称 | 最小宽度 | 最大宽度 | 典型设备 | 容器最大宽度 |
|---------|---------|---------|---------|------------|
| Mobile | 0 | 767px | 手机 | 100% |
| Tablet | 768px | 999px | 平板 | 720px |
| Desktop | 1000px | 1279px | 笔记本 | 960px |
| Wide | 1280px | 1919px | 台式机 | 1200px |
| UltraWide | 1920px | ∞ | 宽屏显示器 | 1600px |

---

## 2. 视口单位

### 2.1 动态视口单位

**CSS定义**:
```css
/* 使用动态视口单位适配移动端虚拟键盘 */
.fullscreen-container {
  /* 后备方案 */
  height: 100vh;
  /* 动态视口高度（优先使用） */
  height: 100dvh;
}

.fullwidth-container {
  /* 后备方案 */
  width: 100vw;
  /* 动态视口宽度（优先使用） */
  width: 100dvw;
}
```

### 2.2 视口单位应用

```css
/* ✅ 推荐：使用动态视口单位 */
#sheld {
  height: 100dvh;
  width: 100dvw;
}

/* ❌ 不推荐：固定视口单位在移动端可能被虚拟键盘遮挡 */
.bad-container {
  height: 100vh;
}
```

---

## 3. 流式布局

### 3.1 Flexbox布局

**CSS定义**:
```css
/* 响应式Flex容器 */
.flex-container {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-md);
}

.flex-item {
  flex: 1 1 300px;  /* 最小宽度300px，自动换行 */
}

/* 移动端调整 */
@media screen and (max-width: 1000px) {
  .flex-container {
    flex-direction: column;
  }
  
  .flex-item {
    flex: 1 1 100%;
  }
}
```

### 3.2 Grid布局

**CSS定义**:
```css
/* 自适应网格 */
.grid-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: var(--spacing-md);
}

/* 响应式网格 */
@media screen and (max-width: 768px) {
  .grid-container {
    grid-template-columns: 1fr;
  }
}

@media screen and (min-width: 769px) and (max-width: 1000px) {
  .grid-container {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media screen and (min-width: 1001px) {
  .grid-container {
    grid-template-columns: repeat(3, 1fr);
  }
}
```

---

## 4. 组件响应式适配

### 4.1 导航栏适配

**CSS定义**:
```css
/* 桌面端导航 */
#top-bar {
  height: 50px;
  padding: 0 var(--spacing-lg);
}

#top-bar-center {
  display: flex;
}

/* 移动端导航 */
@media screen and (max-width: 1000px) {
  #top-bar {
    height: 56px;
    padding: 0 var(--spacing-md);
  }
  
  #top-bar-center {
    display: none;  /* 隐藏中心区域 */
  }
  
  /* 显示底部导航 */
  #bottom-nav {
    display: flex;
  }
}
```

### 4.2 侧边栏适配

**CSS定义**:
```css
/* 桌面端：固定侧边栏 */
@media screen and (min-width: 1001px) {
  .sidebar {
    position: fixed;
    left: 0;
    top: 50px;
    width: 280px;
    height: calc(100vh - 50px);
  }
  
  .main-content {
    margin-left: 280px;
  }
}

/* 移动端：抽屉侧边栏 */
@media screen and (max-width: 1000px) {
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    width: 300px;
    height: 100vh;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: 200;
  }
  
  .sidebar.open {
    transform: translateX(0);
  }
  
  .main-content {
    margin-left: 0;
  }
}
```

### 4.3 聊天界面适配

**CSS定义**:
```css
/* 桌面端消息 */
.mes {
  padding: var(--spacing-md);
}

.avatar {
  width: 60px;
  height: 60px;
}

.mes_text {
  font-size: var(--mainFontSize);
  padding: var(--spacing-sm) var(--spacing-md);
}

/* 移动端消息 */
@media screen and (max-width: 1000px) {
  .mes {
    padding: var(--spacing-sm);
  }
  
  .avatar {
    width: 40px;
    height: 40px;
  }
  
  .mes_text {
    font-size: var(--fontSize-sm);
    padding: var(--spacing-xs) var(--spacing-sm);
  }
  
  /* 隐藏Swipe按钮，使用手势 */
  .swipe_control {
    display: none;
  }
}
```

### 4.4 输入区域适配

**CSS定义**:
```css
/* 桌面端输入 */
#send_form {
  padding: var(--spacing-md);
}

#send_textarea {
  min-height: 50px;
  max-height: 200px;
  font-size: var(--mainFontSize);
}

/* 移动端输入 */
@media screen and (max-width: 1000px) {
  #send_form {
    padding: var(--spacing-sm);
    /* 确保不被虚拟键盘遮挡 */
    position: sticky;
    bottom: 0;
  }
  
  #send_textarea {
    min-height: 44px;  /* iOS最小触摸目标 */
    max-height: 120px;
    font-size: 16px;   /* 防止iOS自动缩放 */
  }
}
```

---

## 5. 触摸优化

### 5.1 触摸目标尺寸

**CSS定义**:
```css
/* 移动端最小触摸目标：44x44px（iOS）或48x48px（Android） */
@media screen and (max-width: 1000px) {
  .button,
  .menu-item,
  .nav-item {
    min-height: 44px;
    min-width: 44px;
  }
  
  /* 增加可触摸区域 */
  .small-button {
    position: relative;
  }
  
  .small-button::before {
    content: "";
    position: absolute;
    top: -8px;
    right: -8px;
    bottom: -8px;
    left: -8px;
  }
}
```

### 5.2 触摸手势

**CSS定义**:
```css
/* 禁用文本选择（聊天区域除外） */
@media screen and (max-width: 1000px) {
  body {
    user-select: none;
    -webkit-user-select: none;
    -webkit-touch-callout: none;
  }
  
  .mes_text,
  input,
  textarea {
    user-select: text;
    -webkit-user-select: text;
  }
  
  /* 启用滚动惯性 */
  .scrollable {
    -webkit-overflow-scrolling: touch;
    overflow-y: auto;
  }
}
```

### 5.3 Swipe手势支持

**JavaScript伪代码**:
```javascript
// 消息Swipe切换（移动端）
if (isMobile) {
  let touchStartX = 0;
  let touchEndX = 0;
  
  messageElement.addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
  });
  
  messageElement.addEventListener('touchend', (e) => {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
  });
  
  function handleSwipe() {
    if (touchEndX < touchStartX - 50) {
      // 向左滑动
      nextSwipe();
    }
    if (touchEndX > touchStartX + 50) {
      // 向右滑动
      prevSwipe();
    }
  }
}
```

---

## 6. 字体缩放

### 6.1 响应式字体

**CSS定义**:
```css
/* 基础字号响应式调整 */
:root {
  --fontScale: 1;
  --mainFontSize: calc(var(--fontScale) * 15px);
}

/* 移动端字号调整 */
@media screen and (max-width: 768px) {
  :root {
    --fontScale: 0.9;  /* 稍微缩小 */
  }
}

/* 大屏字号调整 */
@media screen and (min-width: 1920px) {
  :root {
    --fontScale: 1.1;  /* 稍微放大 */
  }
}
```

### 6.2 防止iOS自动缩放

**CSS定义**:
```css
/* 防止iOS在横屏时自动放大字体 */
@media screen and (max-width: 1000px) {
  input,
  textarea,
  select {
    font-size: 16px !important;  /* 最小16px防止缩放 */
  }
}
```

---

## 7. 图片响应式

### 7.1 响应式图片

**CSS定义**:
```css
/* 响应式图片容器 */
.responsive-image {
  max-width: 100%;
  height: auto;
  display: block;
}

/* 聊天中的图片 */
.mes_img {
  max-width: 100%;
  height: auto;
}

/* 移动端图片调整 */
@media screen and (max-width: 1000px) {
  .mes_img {
    max-width: 100%;
    border-radius: 8px;
  }
}

/* 桌面端图片 */
@media screen and (min-width: 1001px) {
  .mes_img {
    max-width: 400px;
    border-radius: 8px;
  }
}
```

### 7.2 srcset支持

**HTML示例**:
```html
<img 
  src="avatar.png" 
  srcset="avatar-1x.png 1x, avatar-2x.png 2x, avatar-3x.png 3x"
  alt="头像"
>
```

---

## 8. 容器查询（现代浏览器）

### 8.1 容器查询定义

**CSS定义**:
```css
/* 定义容器 */
.card-container {
  container-type: inline-size;
  container-name: card;
}

/* 基于容器宽度的样式 */
@container card (min-width: 400px) {
  .card {
    flex-direction: row;
  }
}

@container card (max-width: 399px) {
  .card {
    flex-direction: column;
  }
}
```

---

## 9. 方向检测

### 9.1 横竖屏适配

**CSS定义**:
```css
/* 竖屏 */
@media screen and (orientation: portrait) {
  .sidebar {
    width: 100%;
    height: 40vh;
    bottom: 0;
  }
}

/* 横屏 */
@media screen and (orientation: landscape) {
  .sidebar {
    width: 300px;
    height: 100vh;
    left: 0;
  }
}

/* 移动端横屏特殊处理 */
@media screen and (max-width: 1000px) and (orientation: landscape) {
  #top-bar {
    height: 40px;  /* 减小高度 */
  }
  
  .mes {
    padding: var(--spacing-xs);
  }
}
```

---

## 10. 打印样式

### 10.1 打印优化

**CSS定义**:
```css
@media print {
  /* 隐藏不必要的元素 */
  #top-bar,
  #send_form,
  .swipe_control,
  .mes_buttons {
    display: none !important;
  }
  
  /* 调整颜色为打印友好 */
  body {
    background-color: white;
    color: black;
  }
  
  .mes_text {
    background-color: white;
    border: 1px solid #ccc;
    box-shadow: none;
  }
  
  /* 避免分页断裂 */
  .mes {
    page-break-inside: avoid;
  }
  
  /* 移除阴影和模糊 */
  * {
    text-shadow: none !important;
    box-shadow: none !important;
    backdrop-filter: none !important;
  }
}
```

---

## 11. 性能优化

### 11.1 条件加载

**CSS定义**:
```css
/* 移动端不加载桌面端资源 */
@media screen and (max-width: 1000px) {
  .desktop-only {
    display: none;
  }
}

@media screen and (min-width: 1001px) {
  .mobile-only {
    display: none;
  }
}
```

### 11.2 减少重绘

**CSS定义**:
```css
/* 使用transform替代position改变 */
@media screen and (max-width: 1000px) {
  .drawer {
    /* ❌ 性能差 */
    /* left: -300px; */
    
    /* ✅ 性能好 */
    transform: translateX(-100%);
  }
}
```

---

## 12. Figma 使用指南

### 12.1 创建响应式框架

1. **设置画板**：
   - Mobile: 375x812 (iPhone)
   - Tablet: 768x1024 (iPad)
   - Desktop: 1440x900

2. **使用Auto Layout**：
   - 设置最小/最大宽度
   - 配置响应式调整规则

3. **创建变体**：
   - 属性：`Device` = Mobile | Tablet | Desktop
   - 每个组件创建对应变体

### 12.2 响应式组件

1. **设置约束**：
   - Left & Right：固定宽度
   - Left：固定左侧，右侧自适应
   - Scale：等比缩放

2. **使用插件**：
   - "Breakpoints"：预览不同断点
   - "Responsive"：生成响应式代码

### 12.3 导出JSON

```json
{
  "breakpoints": {
    "mobile": "768px",
    "tablet": "1000px",
    "desktop": "1280px",
    "wide": "1920px"
  },
  "containers": {
    "mobile": "100%",
    "tablet": "720px",
    "desktop": "960px",
    "wide": "1200px"
  }
}
```

---

## 13. Sketch 使用指南

### 13.1 创建响应式Symbol

1. 使用Anima的Breakpoints功能
2. 设置不同断点的布局
3. 配置响应式规则

### 13.2 使用插件

- **Automate**：批量调整尺寸
- **Paddy**：智能内边距

---

## 14. 测试检查清单

### 14.1 设备测试

- [ ] iPhone SE (375x667)
- [ ] iPhone 12 Pro (390x844)
- [ ] iPad (768x1024)
- [ ] iPad Pro (1024x1366)
- [ ] 笔记本 (1366x768)
- [ ] 台式机 (1920x1080)
- [ ] 宽屏 (2560x1440)

### 14.2 功能测试

- [ ] 导航在各设备正常工作
- [ ] 聊天界面布局适配
- [ ] 输入框不被虚拟键盘遮挡
- [ ] 触摸目标足够大
- [ ] 图片正确缩放
- [ ] 横竖屏切换正常
- [ ] 滚动流畅

---

## 相关文档

- [01-设计令牌](./01-设计令牌.md) - 响应式令牌
- [08-布局网格](./08-布局网格.md) - 布局系统
- [12-聊天界面](./12-聊天界面.md) - 聊天响应式

---

**最后更新**: 2025-12-21 | **版本**: 1.0.0
