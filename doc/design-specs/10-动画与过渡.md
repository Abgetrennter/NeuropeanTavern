# 10-动画与过渡规范

## 文档信息
- **版本**: 1.0.0
- **最后更新**: 2025-12-21
- **依赖**: [01-设计令牌](./01-设计令牌.md)

---

## 概述

本文档定义SillyTavern中所有动画和过渡效果的设计规范，包括时长、缓动函数、关键帧动画、微交互等，确保整个应用具有统一流畅的动效体验。

---

## 1. 动画时长系统

### 1.1 时长令牌

**CSS定义**:
```css
/* 基础时长 */
--duration-instant: 0ms;         /* 即时，无动画 */
--duration-fast: 100ms;          /* 快速交互反馈 */
--duration-base: 125ms;          /* 默认过渡时长 */
--duration-normal: 200ms;        /* 普通动画 */
--duration-slow: 300ms;          /* 慢速动画 */
--duration-slower: 500ms;        /* 更慢的动画 */

/* 特殊场景时长 */
--duration-page-transition: 400ms;   /* 页面切换 */
--duration-drawer: 300ms;            /* 抽屉滑出 */
--duration-modal: 200ms;             /* 模态框 */
--duration-toast: 300ms;             /* 提示框 */
--duration-tooltip: 150ms;           /* 工具提示 */
```

### 1.2 时长应用规则

| 元素类型 | 时长 | 说明 |
|---------|------|------|
| 按钮Hover | 125ms | 快速响应用户交互 |
| 输入框Focus | 125ms | 焦点状态即时反馈 |
| 卡片Hover | 200ms | 平滑的视觉变化 |
| 抽屉打开 | 300ms | 给予足够的视觉过渡 |
| 模态框出现 | 200ms | 快速但不突兀 |
| 页面切换 | 400ms | 完整的场景转换 |
| 加载动画 | 无限循环 | 持续提示加载状态 |

---

## 2. 缓动函数系统

### 2.1 缓动函数令牌

**CSS定义**:
```css
/* 标准缓动 */
--ease-linear: linear;
--ease-in: cubic-bezier(0.4, 0, 1, 1);
--ease-out: cubic-bezier(0, 0, 0.2, 1);
--ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);

/* 自定义缓动 */
--ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);      /* 平滑过渡 */
--ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);  /* 弹跳效果 */
--ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275); /* 弹性效果 */
--ease-sharp: cubic-bezier(0.4, 0, 0.6, 1);       /* 锐利过渡 */
```

### 2.2 缓动函数应用规则

| 交互场景 | 缓动函数 | 原因 |
|---------|---------|------|
| 按钮点击 | ease-out | 快速响应，自然减速 |
| 抽屉滑出 | ease-in-out | 平滑的进入和退出 |
| 模态框出现 | ease-smooth | 优雅的淡入效果 |
| Hover悬停 | ease-out | 快速响应，舒适减速 |
| 卡片翻转 | ease-in-out | 对称的翻转动作 |
| 弹性按钮 | ease-bounce | 有趣的视觉反馈 |
| 加载旋转 | linear | 匀速旋转 |

---

## 3. 基础过渡效果

### 3.1 淡入淡出 (Fade)

**CSS定义**:
```css
/* 淡入 */
@keyframes fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.fade-in {
  animation: fade-in var(--duration-normal) var(--ease-out);
}

/* 淡出 */
@keyframes fade-out {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

.fade-out {
  animation: fade-out var(--duration-normal) var(--ease-in);
}
```

### 3.2 滑动 (Slide)

**CSS定义**:
```css
/* 从上滑入 */
@keyframes slide-in-top {
  from {
    transform: translateY(-20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* 从下滑入 */
@keyframes slide-in-bottom {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* 从左滑入 */
@keyframes slide-in-left {
  from {
    transform: translateX(-20px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* 从右滑入 */
@keyframes slide-in-right {
  from {
    transform: translateX(20px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}
```

### 3.3 缩放 (Scale)

**CSS定义**:
```css
/* 放大进入 */
@keyframes scale-in {
  from {
    transform: scale(0.9);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

/* 缩小退出 */
@keyframes scale-out {
  from {
    transform: scale(1);
    opacity: 1;
  }
  to {
    transform: scale(0.9);
    opacity: 0;
  }
}

/* 弹跳缩放 */
@keyframes scale-bounce {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
  }
  100% {
    transform: scale(1);
  }
}
```

---

## 4. 组合动画

### 4.1 模态框出现动画

**CSS定义**:
```css
@keyframes modal-appear {
  from {
    transform: scale(0.9) translateY(-20px);
    opacity: 0;
  }
  to {
    transform: scale(1) translateY(0);
    opacity: 1;
  }
}

.modal-enter {
  animation: modal-appear 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
```

### 4.2 Toast通知动画

**CSS定义**:
```css
@keyframes toast-slide-in {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes toast-slide-out {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(100%);
    opacity: 0;
  }
}

.toast-enter {
  animation: toast-slide-in 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.toast-exit {
  animation: toast-slide-out 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
```

### 4.3 抽屉滑动动画

**CSS定义**:
```css
/* 左侧抽屉 */
.drawer-left {
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateX(-100%);
}

.drawer-left.open {
  transform: translateX(0);
}

/* 右侧抽屉 */
.drawer-right {
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateX(100%);
}

.drawer-right.open {
  transform: translateX(0);
}

/* 底部抽屉 */
.drawer-bottom {
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateY(100%);
}

.drawer-bottom.open {
  transform: translateY(0);
}
```

---

## 5. 加载动画

### 5.1 旋转加载

**CSS定义**:
```css
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--black50a);
  border-top-color: var(--SmartThemeQuoteColor);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
```

### 5.2 脉冲加载

**CSS定义**:
```css
@keyframes pulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.5;
    transform: scale(0.95);
  }
}

.pulse {
  animation: pulse 2s ease-in-out infinite;
}
```

### 5.3 点状加载

**CSS定义**:
```css
@keyframes dot-flashing {
  0%, 80%, 100% {
    opacity: 0;
  }
  40% {
    opacity: 1;
  }
}

.loading-dots {
  display: flex;
  gap: 6px;
}

.loading-dot {
  width: 8px;
  height: 8px;
  background-color: var(--SmartThemeQuoteColor);
  border-radius: 50%;
  animation: dot-flashing 1.4s infinite linear;
}

.loading-dot:nth-child(2) {
  animation-delay: 0.2s;
}

.loading-dot:nth-child(3) {
  animation-delay: 0.4s;
}
```

### 5.4 进度条动画

**CSS定义**:
```css
@keyframes progress-indeterminate {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

.progress-bar-indeterminate {
  position: relative;
  overflow: hidden;
}

.progress-bar-indeterminate::after {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 50%;
  height: 100%;
  background-color: var(--SmartThemeQuoteColor);
  animation: progress-indeterminate 1.5s ease-in-out infinite;
}
```

---

## 6. 微交互动画

### 6.1 按钮点击效果

**CSS定义**:
```css
.button {
  transition: all var(--duration-base) var(--ease-out);
}

.button:hover {
  transform: scale(1.02);
}

.button:active {
  transform: scale(0.98);
}

/* 波纹效果 */
@keyframes ripple {
  to {
    transform: scale(4);
    opacity: 0;
  }
}

.button-ripple {
  position: relative;
  overflow: hidden;
}

.button-ripple::after {
  content: "";
  position: absolute;
  border-radius: 50%;
  background-color: rgba(255, 255, 255, 0.5);
  width: 20px;
  height: 20px;
  transform: scale(0);
  opacity: 1;
}

.button-ripple:active::after {
  animation: ripple 0.6s ease-out;
}
```

### 6.2 复选框勾选动画

**CSS定义**:
```css
@keyframes checkbox-check {
  0% {
    width: 0;
    height: 0;
  }
  50% {
    width: 4px;
    height: 0;
  }
  100% {
    width: 4px;
    height: 8px;
  }
}

input[type="checkbox"]:checked::after {
  animation: checkbox-check 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
```

### 6.3 开关切换动画

**CSS定义**:
```css
.toggle-switch input:checked + .toggle-slider::before {
  transform: translateX(20px);
  transition: transform var(--duration-base) var(--ease-smooth);
}

.toggle-switch input:checked + .toggle-slider {
  background-color: var(--SmartThemeQuoteColor);
  transition: background-color var(--duration-base) var(--ease-smooth);
}
```

### 6.4 输入框焦点动画

**CSS定义**:
```css
.input {
  transition: all var(--duration-base) var(--ease-out);
}

.input:focus {
  outline: 2px solid var(--SmartThemeQuoteColor);
  outline-offset: 2px;
  animation: input-focus-glow 0.3s ease-out;
}

@keyframes input-focus-glow {
  0% {
    outline-offset: 0;
    outline-color: transparent;
  }
  100% {
    outline-offset: 2px;
    outline-color: var(--SmartThemeQuoteColor);
  }
}
```

---

## 7. 页面过渡动画

### 7.1 淡入淡出过渡

**CSS定义**:
```css
@keyframes page-fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes page-fade-out {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

.page-enter {
  animation: page-fade-in 0.4s ease-out;
}

.page-exit {
  animation: page-fade-out 0.4s ease-in;
}
```

### 7.2 滑动过渡

**CSS定义**:
```css
@keyframes page-slide-left-in {
  from {
    transform: translateX(100%);
  }
  to {
    transform: translateX(0);
  }
}

@keyframes page-slide-left-out {
  from {
    transform: translateX(0);
  }
  to {
    transform: translateX(-100%);
  }
}

.page-slide-enter {
  animation: page-slide-left-in 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.page-slide-exit {
  animation: page-slide-left-out 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}
```

---

## 8. 特殊效果动画

### 8.1 打字机效果

**CSS定义**:
```css
@keyframes typing {
  from {
    width: 0;
  }
  to {
    width: 100%;
  }
}

@keyframes blink-caret {
  from, to {
    border-color: transparent;
  }
  50% {
    border-color: var(--SmartThemeQuoteColor);
  }
}

.typewriter {
  overflow: hidden;
  border-right: 2px solid var(--SmartThemeQuoteColor);
  white-space: nowrap;
  animation: 
    typing 3.5s steps(40, end),
    blink-caret 0.75s step-end infinite;
}
```

### 8.2 闪烁高亮

**CSS定义**:
```css
@keyframes highlight-flash {
  0%, 100% {
    background-color: transparent;
  }
  50% {
    background-color: rgba(225, 138, 36, 0.3);
  }
}

.highlight-flash {
  animation: highlight-flash 1s ease-in-out 3;
}
```

### 8.3 震动效果

**CSS定义**:
```css
@keyframes shake {
  0%, 100% {
    transform: translateX(0);
  }
  10%, 30%, 50%, 70%, 90% {
    transform: translateX(-5px);
  }
  20%, 40%, 60%, 80% {
    transform: translateX(5px);
  }
}

.shake {
  animation: shake 0.5s ease-in-out;
}
```

### 8.4 弹跳效果

**CSS定义**:
```css
@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-20px);
  }
  60% {
    transform: translateY(-10px);
  }
}

.bounce {
  animation: bounce 1s ease-in-out;
}
```

---

## 9. 性能优化

### 9.1 使用GPU加速

**CSS定义**:
```css
/* 强制GPU加速的属性 */
.gpu-accelerated {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

/* 仅对transform和opacity做动画 */
.optimized-animation {
  transition: transform 0.3s ease, opacity 0.3s ease;
  /* 避免对 left, top, width, height 等做动画 */
}
```

### 9.2 减少重绘和回流

```css
/* 优先使用transform替代position */
/* ❌ 不推荐 */
.bad-animation {
  transition: left 0.3s ease;
}

/* ✅ 推荐 */
.good-animation {
  transition: transform 0.3s ease;
}
```

### 9.3 使用will-change

```css
.will-animate {
  will-change: transform, opacity;
}

/* 动画结束后移除 */
.will-animate.done {
  will-change: auto;
}
```

---

## 10. 响应式动画

### 10.1 移动端动画调整

**CSS定义**:
```css
/* 移动端减少动画时长 */
@media screen and (max-width: 1000px) {
  :root {
    --duration-base: 100ms;
    --duration-normal: 150ms;
    --duration-slow: 200ms;
  }
}

/* 用户偏好：减弱动画 */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
```

---

## 11. Figma 使用指南

### 11.1 创建动画原型

1. **使用Smart Animate**：
   - 在Figma中创建两个相同命名的图层
   - 在原型模式选择"Smart Animate"
   - 设置动画时长和缓动函数

2. **常用缓动设置**：
   - 按钮Hover：Ease Out, 125ms
   - 模态框：Ease In-Out, 300ms
   - 抽屉：Ease In-Out, 300ms

3. **创建加载动画**：
   - 创建旋转动画帧
   - 使用After Delay循环

### 11.2 导出CSS动画

使用Figma插件"Animator"导出CSS动画代码

### 11.3 导出JSON

```json
{
  "duration": {
    "instant": "0ms",
    "fast": "100ms",
    "base": "125ms",
    "normal": "200ms",
    "slow": "300ms"
  },
  "easing": {
    "linear": "linear",
    "easeIn": "cubic-bezier(0.4, 0, 1, 1)",
    "easeOut": "cubic-bezier(0, 0, 0.2, 1)",
    "easeInOut": "cubic-bezier(0.4, 0, 0.2, 1)",
    "smooth": "cubic-bezier(0.4, 0, 0.2, 1)"
  }
}
```

---

## 12. Sketch 使用指南

### 12.1 创建动画原型

1. 使用Anima插件创建交互原型
2. 设置时长和缓动函数
3. 导出HTML原型预览

### 12.2 使用Principle

将Sketch设计导入Principle创建高级动画原型

---

## 相关文档

- [01-设计令牌](./01-设计令牌.md) - 动画令牌定义
- [04-按钮组件](./04-按钮组件.md) - 按钮动画
- [09-弹窗系统](./09-弹窗系统.md) - 弹窗动画

---

**最后更新**: 2025-12-21 | **版本**: 1.0.0
