# SillyTavern 前端UI模块化设计分析

> **文档目标**: 系统性提取SillyTavern前端界面的UI设计模式，便于移植和复刻
> **分析范围**: public目录下的主应用前端界面
> **分析方式**: 按功能组件划分，聚焦设计层面而非具体数值

---

## 目录

1. [整体布局架构](#1-整体布局架构)
2. [顶部导航栏](#2-顶部导航栏)
3. [侧边抽屉系统](#3-侧边抽屉系统)
4. [聊天消息区域](#4-聊天消息区域)
5. [底部输入表单](#5-底部输入表单)
6. [角色选择器](#6-角色选择器)
7. [弹窗系统](#7-弹窗系统)
8. [表单控件组件](#8-表单控件组件)
9. [响应式设计策略](#9-响应式设计策略)
10. [主题系统](#10-主题系统)

---

## 1. 整体布局架构

### 1.1 设计理念

采用固定视口布局模式，整个应用占满全屏，不允许页面级别滚动，所有滚动在特定容器内进行。

### 1.2 层级结构

```
视觉层级（由底到顶）：
├── 背景层（#bg1）
│   └── 背景图像/视频
├── 内容层
│   ├── 顶部导航栏（固定定位）
│   ├── 中央聊天区域（弹性布局）
│   └── 底部输入区（固定定位）
└── 浮层
    ├── 侧边抽屉（从边缘滑入）
    ├── 模态弹窗（居中覆盖）
    └── 上下文菜单（跟随鼠标）
```

### 1.3 布局特征

**容器定位策略**：
- 顶栏和底栏使用固定定位，始终可见
- 聊天区域使用动态高度计算，填充剩余空间
- 抽屉使用固定定位从屏幕边缘滑入
- 所有主要容器使用backdrop-filter实现毛玻璃效果

**空间组织**：
- 桌面端：中央内容区域采用固定最大宽度（可配置）
- 移动端：内容区域占满100%视口宽度
- 使用flexbox进行主轴布局，grid用于卡片网格

### 1.4 视觉层次

**深度表现**：
- 背景层：模糊强度可调
- 内容层：半透明背景+模糊叠加
- 浮层：更高的模糊度+边框+阴影
- 焦点元素：轮廓高亮

---

## 2. 顶部导航栏

### 2.1 结构组成

顶部导航栏采用水平线性布局，分为左侧功能区和右侧状态区。

**组成元素**：
- 左侧：主菜单按钮、角色列表按钮
- 中间：（可扩展区域）
- 右侧：API状态、设置、扩展、背景等功能按钮

### 2.2 视觉设计

**外观特征**：
- 固定高度，基于字体大小动态计算
- 半透明深色背景
- 底部边框分隔线
- 图标统一尺寸和间距

**图标风格**：
- 使用FontAwesome图标库
- 图标尺寸：基于主字体大小的倍数
- 状态颜色：
  - 未激活：主题文本色
  - 悬停：亮度增加
  - 激活：特殊主题色
  - 警告：红色/黄色

### 2.3 交互行为

**按钮交互**：
- 悬停：图标放大动画 + 背景高亮
- 点击：触发对应抽屉展开或模态框
- 长按/右键：（部分按钮）显示快捷菜单

**状态指示**：
- API连接状态：图标变换（插头图标）
- 颜色编码：绿色连接、红色断开、黄色警告

### 2.4 响应式适配

**移动端变化**：
- 图标尺寸略微增大（便于触摸）
- 间距调整适应手指点击
- 部分次要按钮收起到菜单中

---

## 3. 侧边抽屉系统

### 3.1 抽屉类型

应用包含多个侧边抽屉，从屏幕左右两侧滑入：

**左侧抽屉**：
- AI响应配置面板
- 角色管理面板

**右侧抽屉**：
- 用户设置面板
- 世界信息面板
- 背景管理面板
- 扩展设置面板
- 角色形象管理面板

### 3.2 设计结构

**抽屉组成**：
```
抽屉容器
├── 抽屉触发器（图标按钮）
└── 抽屉内容区
    ├── 头部（标题+固定按钮）
    ├── 主体（可滚动内容）
    └── 底部（操作按钮区）
```

### 3.3 视觉特征

**外观设计**：
- 宽度：桌面端固定宽度，移动端全屏
- 背景：深色半透明 + 高模糊度毛玻璃
- 边框：与主内容区分隔的边框
- 阴影：投射阴影增强层次感

**内容组织**：
- 标题区：大号粗体标题 + 图标
- 分段：使用分隔线和小标题
- 控件分组：相关控件用边框或背景块组合
- 滚动条：自定义样式，半透明圆角

### 3.4 交互模式

**展开/收起**：
- 动画：滑入/滑出动画（约125ms）
- 触发：点击触发器图标
- 蒙层：可选择性显示半透明遮罩
- 关闭方式：
  - 点击蒙层（如果启用）
  - 再次点击触发器
  - 点击关闭按钮
  - ESC键

**固定模式**：
- 部分抽屉支持"钉住"功能
- 钉住后保持展开状态
- 图标指示：锁定/解锁图标切换

**手势支持（移动端）**：
- 从边缘向外滑动：收起抽屉
- 向下拖动头部：可能触发收起

### 3.5 内部组件

**嵌套折叠面板**：
- 使用`inline-drawer`组件
- 标题行可点击展开/收起
- 雪佛龙图标指示状态（上/下）
- 展开动画：高度渐变 + 图标旋转

**滚动容器**：
- 头部区域固定
- 主体区域可滚动
- 滚动到底部时显示返回顶部按钮

---

## 4. 聊天消息区域

### 4.1 整体布局

聊天区域是应用的核心，占据主要视觉空间。

**布局特征**：
- 垂直滚动容器
- 消息流从上到下排列
- 自动滚动到最新消息（可配置）
- 支持虚拟滚动（懒加载）

### 4.2 消息卡片设计

**消息结构**：
```
消息容器 (.mes)
├── 复选框区域（批量操作）
├── 头像区域
│   ├── 头像图片
│   ├── 消息ID显示
│   ├── 计时器
│   └── Token计数器
├── 消息主体区
│   ├── 名称栏
│   │   ├── 角色名
│   │   ├── 时间戳
│   │   └── 状态图标
│   ├── 消息内容
│   └── 操作按钮组
└── 滑动切换按钮（左右箭头）
```

### 4.3 视觉层次

**用户/AI消息区分**：
- 背景色：用户消息和AI消息使用不同的色调
- 对齐方式：可选左对齐或左右区分
- 头像位置：用户消息头像可配置在左侧或右侧

**头像设计**：
- 尺寸：基础尺寸可配置
- 形状：方形、圆角方形、圆形三种样式
- 边框：可选边框和阴影
- 内嵌图标：系统消息使用特殊图标

**内容排版**：
- 字体：主题字体或等宽字体（代码块）
- 间距：段落间距、列表缩进
- Markdown渲染：
  - 标题层级样式
  - 代码块背景和语法高亮
  - 引用块左侧边框和缩进
  - 表格边框和隔行变色
  - 链接下划线和颜色

### 4.4 交互功能

**消息操作**：
- 编辑：点击编辑按钮进入编辑模式
- 删除：点击删除按钮（可配置确认）
- 复制：一键复制消息内容
- 翻译：调用翻译服务
- 生成图像：触发图像生成
- 隐藏/显示：控制消息在提示词中的可见性

**操作按钮显示逻辑**：
- 默认：悬停时显示主要按钮
- 点击"更多"：展开全部操作按钮
- 移动端：触摸消息卡片显示按钮

**Swipe功能**：
- 左右箭头按钮切换不同生成结果
- 滑动指示器显示当前位置
- 手势支持：左右滑动切换（移动端）

**编辑模式**：
- 文本框：可调整大小的文本域
- 工具栏：
  - 确认/取消按钮
  - 复制按钮
  - 添加reasoning块
  - 删除按钮
  - 上移/下移消息

### 4.5 特殊消息类型

**系统消息**：
- 灰色文本
- 居中对齐
- 图标标识
- 可选择隐藏

**Reasoning消息块**：
- 折叠式设计
- 左侧边框颜色标识
- 标题显示思考时间
- 内容区域可展开/收起
- 饱和度降低的文本颜色

**附件消息**：
- 图片：内嵌显示，可点击放大
- 文件：显示文件名和图标
- 视频：内嵌播放器

### 4.6 滚动行为

**自动滚动**：
- 新消息到达时滚动到底部
- 可配置关闭自动滚动
- 向上滚动后暂停自动滚动
- 滚动到底部恢复自动滚动

**滚动指示**：
- 滚动条自定义样式
- 新消息提示浮动按钮
- 返回底部快捷按钮

---

## 5. 底部输入表单

### 5.1 布局结构

输入表单固定在屏幕底部，采用多行布局以容纳各种功能。

**组成区域**：
```
输入表单容器
├── 顶部工具栏（可选显示）
│   ├── 快捷按钮组
│   └── 模式切换器
├── 主输入区
│   ├── 左侧按钮组
│   ├── 中央文本输入框
│   └── 右侧按钮组
└── 底部状态栏（可选显示）
    └── Token计数、状态信息
```

### 5.2 视觉设计

**外观特征**：
- 背景：半透明深色 + 高模糊
- 边框：顶部边框分隔
- 高度：根据输入内容自动调整
- 最大高度限制，超出后滚动

**输入框设计**：
- 多行文本域
- 自动高度调整
- 占位符文本
- Markdown格式化工具栏（可选）
- 自动完成提示

### 5.3 按钮组设计

**左侧按钮**：
- 附加文件按钮
- 角色切换按钮（群聊）
- 其他扩展按钮

**右侧按钮**：
- 发送按钮（主要操作）
- Continue按钮（快速继续）
- Impersonate按钮（角色扮演）
- 停止生成按钮

**按钮状态**：
- 默认：半透明背景
- 悬停：背景高亮 + 缩放
- 激活：特殊颜色标识
- 禁用：降低不透明度

### 5.4 交互功能

**输入辅助**：
- Enter发送：可配置
  - 禁用
  - 自动检测（PC端）
  - 始终启用
- Shift+Enter：换行
- 自动完成：斜杠命令、变量、表情符号

**快捷操作**：
- 上箭头：编辑最后消息
- Ctrl+Enter：强制发送
- 拖放文件：快速附加

### 5.5 紧凑模式

**布局调整**：
- 按钮收缩为图标
- 减少间距
- 单行布局
- 移除部分次要按钮

### 5.6 移动端适配

**触摸优化**：
- 增大按钮触摸区域
- 调整按钮间距
- 虚拟键盘适配
- 输入框焦点时界面调整

---

## 6. 角色选择器

### 6.1 网格/列表布局

角色选择器支持两种视图模式：网格视图和列表视图。

**网格视图**：
- 响应式列数（基于容器宽度）
- 卡片式设计
- 头像+名称+描述
- 悬停时显示完整信息

**列表视图**：
- 单列纵向排列
- 头像在左，信息在右
- 更详细的元数据显示
- 更高的信息密度

### 6.2 角色卡片设计

**卡片元素**：
```
角色卡片
├── 头像容器
│   ├── 头像图片
│   └── 状态徽章
├── 信息区
│   ├── 角色名称
│   ├── 附加信息
│   │   ├── 版本号
│   │   ├── 助手标记
│   │   └── 来源URL
│   ├── 描述文本（摘要）
│   └── 标签列表
└── 收藏图标
```

### 6.3 视觉层次

**头像处理**：
- 圆角边框
- 阴影效果
- 加载占位符
- 失败时显示默认图标

**文本层次**：
- 角色名：大号粗体
- 附加信息：小号半透明
- 描述：常规字体，行数限制+省略号
- 标签：小号彩色徽章

**状态指示**：
- 收藏：金色星形图标
- 当前选中：高亮边框或背景
- 助手角色：特殊图标标识

### 6.4 交互模式

**选择行为**：
- 单击：选择角色并加载
- 右键：显示上下文菜单
  - 收藏/取消收藏
  - 添加标签
  - 复制
  - 设为助手
  - 删除

**筛选和排序**：
- 搜索框：实时筛选
- 排序下拉：
  - A-Z排序
  - Z-A排序
  - 搜索相关性
- 标签过滤器
- 收藏筛选

**分页**：
- 每页显示数量可配置
- 页码指示器
- 上一页/下一页按钮
- 跳转到指定页

### 6.5 上下文菜单

**菜单样式**：
- 固定定位，跟随鼠标位置
- 白色/浅色背景
- 圆角边框
- 阴影增强层次
- 垂直排列菜单项

**菜单项**：
- 图标+文本标签
- 悬停高亮
- 点击执行操作并关闭菜单

---

## 7. 弹窗系统

### 7.1 弹窗类型

应用使用多种弹窗类型，根据内容复杂度选择：

**模态弹窗**：
- 角色编辑器
- 世界信息编辑器
- 设置面板（移动端）
- 确认对话框

**非模态浮窗**：
- Token计数器
- Prompt查看器
- 日志查看器

### 7.2 设计结构

**弹窗组成**：
```
弹窗容器
├── 遮罩层（半透明黑色）
└── 弹窗主体
    ├── 头部栏
    │   ├── 标题
    │   ├── 功能按钮（最小化/最大化）
    │   └── 关闭按钮
    ├── 内容区（可滚动）
    └── 底部操作栏
        └── 确认/取消按钮
```

### 7.3 视觉设计

**外观特征**：
- 居中定位（垂直和水平）
- 最大宽高限制
- 圆角边框
- 厚重阴影
- 深色半透明背景 + 模糊效果

**头部设计**：
- 标题：大号粗体
- 可拖动区域（桌面端）
- 按钮统一尺寸和间距
- 分隔线或背景色区分

**内容区域**：
- 内边距均匀
- 滚动条自定义样式
- 表单元素对齐
- 分段和分组清晰

### 7.4 交互行为

**打开/关闭动画**：
- 淡入/淡出（遮罩）
- 缩放+淡入（弹窗主体）
- 动画时长约200-300ms

**拖动功能**：
- 拖动头部栏移动弹窗
- 边界限制（不超出视口）
- 移动端禁用拖动

**调整大小**：
- 部分弹窗支持拖拽边缘调整大小
- 最小/最大尺寸限制
- 移动端禁用调整

**键盘支持**：
- ESC键关闭弹窗
- Tab键焦点导航
- Enter键确认（表单）

### 7.5 特殊弹窗

**角色编辑器**：
- 左侧头像编辑区
- 右侧表单区（标签页组织）
- 底部保存/取消按钮
- 实时预览

**确认对话框**：
- 紧凑设计
- 突出显示主要操作按钮
- 危险操作用红色标识
- 可配置显示"不再提示"选项

---

## 8. 表单控件组件

### 8.1 文本输入框

**基础样式**：
- 圆角边框
- 半透明背景
- 边框颜色：默认状态、聚焦状态、错误状态
- 内边距：基于字体大小计算

**状态变化**：
- 聚焦：边框高亮 + 外发光
- 禁用：降低不透明度 + 灰色背景
- 错误：红色边框 + 错误提示文本

**变体**：
- 单行文本框
- 多行文本域（可调整大小）
- 密码输入框（显示/隐藏切换）
- 搜索框（带清除按钮）

### 8.2 选择器

**下拉选择框**：
- 使用Select2库增强
- 自定义样式覆盖
- 搜索功能
- 多选支持
- 分组显示

**单选/复选框**：
- 自定义复选标记
- 色彩跟随主题
- 标签文本可点击
- 禁用状态半透明

**开关切换**：
- 滑块式设计
- 颜色指示状态（绿/灰）
- 平滑过渡动画
- 图标切换（锁定/解锁等）

### 8.3 滑块控件

**范围滑块**：
- 自定义轨道和滑块样式
- 数值显示（内联或独立输入框）
- 双向绑定（滑块↔输入框）
- 步进值和范围限制

**视觉设计**：
- 轨道：半透明背景 + 圆角
- 滑块：圆形 + 阴影 + 高亮
- 填充：已选范围用主题色填充
- 标签：显示当前值和单位

**交互增强**：
- 点击轨道跳转
- 键盘方向键调整
- 滚轮调整（部分实现）
- 点击数值框直接输入

### 8.4 按钮组件

**按钮类型**：
- 主要按钮：实心背景，高对比度
- 次要按钮：边框样式或半透明背景
- 图标按钮：仅图标，圆形或方形
- 文本按钮：无背景，仅文字链接

**视觉状态**：
- 默认：基础样式
- 悬停：背景亮度增加 + 微缩放
- 激活：按下效果
- 加载中：旋转图标 + 禁用点击
- 禁用：降低不透明度 + 去除交互

**尺寸变体**：
- 大按钮：用于主要操作
- 常规按钮：默认尺寸
- 小按钮：紧凑场景
- 图标尺寸：基于字体大小倍数

### 8.5 标签和徽章

**标签设计**：
- 圆角矩形
- 彩色背景（可配置）
- 删除按钮（X图标）
- 紧凑排列，自动换行

**徽章样式**：
- 小号圆形或圆角方形
- 数字/文本指示
- 颜色编码状态
- 位置：通常在图标右上角

### 8.6 工具提示

**Tooltip设计**：
- 深色背景 + 白色文字
- 三角指示箭头
- 跟随鼠标或固定位置
- 延迟显示和隐藏

**内容类型**：
- 简短文本说明
- 快捷键提示
- 状态信息

---

## 9. 响应式设计策略

### 9.1 断点设计

**主要断点**：
- 桌面端：> 1000px
- 平板端：≤ 1000px
- 移动端：≤ 768px（部分组件）

### 9.2 布局转换

**桌面 → 移动**：
- 侧边栏：从固定宽度变为全屏抽屉
- 弹窗：从居中浮动变为全屏
- 多列布局：变为单列堆叠
- 固定头尾：保持固定，内容区域自适应

**网格调整**：
- 角色网格：列数减少（3列 → 2列 → 1列）
- 表单布局：横向排列变为纵向堆叠
- 按钮组：收起为图标或下拉菜单

### 9.3 触摸优化

**交互区域**：
- 按钮最小尺寸：44px × 44px
- 间距增加：避免误触
- 长按手势：触发上下文菜单

**手势支持**：
- 左右滑动：Swipe切换
- 下拉刷新：（部分实现）
- 捏合缩放：图片查看

### 9.4 视口适配

**动态单位使用**：
- dvh/dvw：适配移动端虚拟键盘
- vh/vw：桌面端基础单位
- rem/em：字体和间距

**方向适配**：
- 横屏：增加列数，优化空间利用
- 竖屏：单列布局，纵向滚动

---

## 10. 主题系统

### 10.1 设计变量

应用使用CSS变量系统实现主题定制。

**核心颜色变量**：
- `--SmartThemeBodyColor`: 主文本颜色
- `--SmartThemeEmColor`: 强调文本颜色
- `--SmartThemeQuoteColor`: 引用/高亮颜色
- `--SmartThemeBlurTintColor`: 模糊背景色调
- `--SmartThemeShadowColor`: 阴影颜色
- `--SmartThemeBorderColor`: 边框颜色

**功能性变量**：
- `--mainFontSize`: 基础字体大小
- `--mainFontFamily`: 主字体族
- `--monoFontFamily`: 等宽字体族
- `--blurStrength`: 模糊强度
- `--shadowWidth`: 阴影宽度
- `--animation-duration`: 动画时长

### 10.2 色彩系统

**预定义色彩**：
- 灰度系列：`--grey10` ~ `--grey75`
- 透明度系列：`--black30a`, `--white70a`等
- 语义颜色：`--warning`, `--active`, `--preferred`

**色彩应用**：
- 文本：基于主题主色
- 背景：半透明叠加
- 边框：低对比度分隔
- 高亮：饱和度增加的主色

### 10.3 排版系统

**字体层级**：
- 标题：倍数缩放（1.2x ~ 2x）
- 正文：基础大小
- 小号文本：0.8x ~ 0.9x
- 代码：等宽字体，略小

**行高和间距**：
- 行高：1.4 ~ 1.6
- 段落间距：基于字体大小的倍数
- 标题间距：更大的上下边距

### 10.4 毛玻璃效果

**实现方式**：
- `backdrop-filter: blur()`
- 模糊强度：基于`--blurStrength`变量
- 半透明背景叠加
- 多层叠加增强效果

**应用场景**：
- 顶部导航栏
- 侧边抽屉
- 弹窗背景
- 输入表单

### 10.5 阴影和边框

**阴影策略**：
- 文本阴影：所有文本默认有微阴影
- 盒阴影：浮层和卡片使用
- 多层阴影：重要元素堆叠多个阴影

**边框设计**：
- 分隔线：1px实线
- 容器边框：1px，颜色基于主题
- 聚焦边框：更亮的颜色和轮廓

### 10.6 深色模式支持

**默认为深色主题**：
- 背景：深灰色（#242425）
- 文本：浅色（#dcdcd2）
- 反转对比：降低眼部疲劳

**可定制性**：
- 用户可通过颜色选择器自定义所有主题变量
- 实时预览更改
- 保存多套主题方案

---

## 附录：设计原则总结

### 一致性原则

- 按钮尺寸和间距遵循统一比例
- 图标库统一使用FontAwesome
- 颜色语义保持一致（红色=危险，绿色=成功）

### 层次清晰

- 使用模糊、阴影、边框区分层级
- 重要元素使用更高对比度
- 次要元素降低不透明度

### 响应灵敏

- 所有交互提供即时视觉反馈
- 动画时长控制在100-300ms
- 避免阻塞式操作

### 可访问性

- 焦点指示明确
- 键盘导航完整支持
- 颜色对比度符合WCAG标准（部分）

### 空间利用

- 桌面端合理留白
- 移动端最大化内容区域
- 抽屉和弹窗按需显示，不占用常驻空间

---

**文档版本**: 1.0  
**最后更新**: 2025年  
**分析对象**: SillyTavern public目录前端界面
